<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/tabs/movies" text="Zpět"></ion-back-button>
    </ion-buttons>
    <ion-title>{{ movie?.title || 'Detail filmu' }}</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  @if (isLoading) {
    <div class="loading">
      <ion-spinner></ion-spinner>
      <p>Načítám detail...</p>
    </div>
  } @else if (movie) {
    <div class="movie-detail">
      <div class="content">
        <img [src]="getPosterUrl(movie.poster_path)" class="poster" [alt]="movie.title">
        
        <h1>{{ movie.title }}</h1>
        
        @if (movie.original_title !== movie.title) {
          <p class="original-title">{{ movie.original_title }}</p>
        }
        
        <div class="meta">
          <span>{{ getYear(movie.release_date) }}</span>
          <span>•</span>
          <span>{{ movie.runtime }} min</span>
          <span>•</span>
          <span>{{ getRatingPercent(movie.vote_average) }} %</span>
        </div>
        
        @if (movie.genres.length > 0) {
          <div class="genres">
            @for (genre of movie.genres; track genre.id) {
              <span class="genre">{{ genre.name }}</span>
            }
          </div>
        }
        
        @if (movie.overview) {
          <h2>Popis</h2>
          <p class="overview">{{ movie.overview }}</p>
        }

        <!-- Štáb (režisér a hudba v gridu jako herci) -->
          @if (getDirector() || getComposer()) {
            <h2>Štáb</h2>
            <div class="cast-grid">
              @if (getDirector(); as director) {
                <div class="cast-card">
                  @if (director.profile_path) {
                    <img [src]="getProfileUrl(director.profile_path)" [alt]="director.name">
                  } @else {
                    <div class="no-photo">?</div>
                  }
                  <div class="cast-info">
                    <p class="name">{{ director.name }}</p>
                    <p class="character">Režie</p>
                  </div>
                </div>
              }

              @if (getComposer(); as composer) {
                <div class="cast-card">
                  @if (composer.profile_path) {
                    <img [src]="getProfileUrl(composer.profile_path)" [alt]="composer.name">
                  } @else {
                    <div class="no-photo">?</div>
                  }
                  <div class="cast-info">
                    <p class="name">{{ composer.name }}</p>
                    <p class="character">Hudba</p>
                  </div>
                </div>
              }
            </div>
          }

          <!-- Herci -->
          @if (movie.credits?.cast?.length) {
            <h2>Herci</h2>
            <div class="cast-grid">
              @for (actor of (movie.credits?.cast || []).slice(0, 12); track actor.id) {
                <div class="cast-card">
                  @if (actor.profile_path) {
                    <img [src]="getProfileUrl(actor.profile_path)" [alt]="actor.name">
                  } @else {
                    <div class="no-photo">?</div>
                  }
                  <div class="cast-info">
                    <p class="name">{{ actor.name }}</p>
                    <p class="character">{{ actor.character }}</p>
                  </div>
                </div>
              }
            </div>
          }
        </div>
      </div>
  }

  <ion-fab slot="fixed" vertical="bottom" horizontal="end">
  <ion-fab-button (click)="openAddToListMenu()">
    <ion-icon [name]="isInAnyList() ? 'bookmark' : 'bookmark-outline'"></ion-icon>
  </ion-fab-button>
</ion-fab>
</ion-content>
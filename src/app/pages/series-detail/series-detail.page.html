<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/tabs/series" text="Zpět"></ion-back-button>
    </ion-buttons>
    <ion-title>{{ series?.name || 'Detail seriálu' }}</ion-title>

    <ion-buttons slot="end">
      <ion-button (click)="openAddToListMenu()">
        <ion-icon 
          slot="icon-only" 
          [name]="isInAnyList() ? 'bookmark' : 'bookmark-outline'"
        ></ion-icon>
      </ion-button>
    </ion-buttons>
    
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  @if (isLoading) {
    <div class="loading">
      <ion-spinner></ion-spinner>
      <p>Načítám detail...</p>
    </div>
  } @else if (series) {
    <div class="series-detail">
      <div class="content">
        
        <!-- Header s posterem a info VEDLE SEBE -->
        <div class="header-section">
          <!-- Plakát -->
          <div class="poster-wrapper">
            <img [src]="getPosterUrl(series.poster_path)" class="poster" [alt]="series.name">
          </div>

          <!-- Info vedle plakátu -->
          <div class="header-info">
            <h1>{{ series.name }}</h1>
            
            @if (series.original_name !== series.name) {
              <p class="original-title">{{ series.original_name }}</p>
            }
            
            <div class="meta">
              <span>{{ getYear(series.first_air_date) }}</span>
              @if(series.number_of_seasons > 0){
                <span>•</span>
                <span>{{ series.number_of_seasons }} sezón</span>
              }
              @if(series.number_of_episodes > 0){
                <span>|</span>
                <span>{{ series.number_of_episodes }} epizod</span>
              }
            </div>

            <!-- Rating kruh -->
            <div class="rating-section">
              <div class="rating-circle">
                <svg viewBox="0 0 36 36">
                  <circle class="rating-bg" cx="18" cy="18" r="16"></circle>
                  <circle 
                    class="rating-progress" 
                    cx="18" 
                    cy="18" 
                    r="16"
                    [attr.stroke]="getRatingColor(series.vote_average)"
                    [attr.stroke-dasharray]="getRatingDashArray(series.vote_average)"
                  ></circle>
                </svg>
                <span class="rating-text">{{ getRatingPercent(series.vote_average) }}</span>
              </div>
              <span class="rating-label"> {{series.vote_count}} Hodnocení</span>
            </div>
            
            @if (series.genres.length > 0) {
              <div class="genres">
                @for (genre of series.genres; track genre.id) {
                  <span class="genre">{{ genre.name }}</span>
                }
              </div>
            }
          </div>
        </div>

        <!-- Popis POD plakátem -->
        @if (series.overview) {
          <div class="section">
            <h2>Popis</h2>
            <p class="overview">{{ series.overview }}</p>
          </div>
        }

        <!-- Štáb -->
        @if (getDirector() || getComposer()) {
          <div class="section">
            <h2>Štáb</h2>
            <div class="cast-grid">
              @if (getDirector(); as director) {
                <div class="cast-card">
                  @if (director.profile_path) {
                    <img [src]="getProfileUrl(director.profile_path)" [alt]="director.name">
                  } @else {
                    <div class="no-photo">?</div>
                  }
                  <div class="cast-info">
                    <p class="name">{{ director.name }}</p>
                    <p class="character">Režie</p>
                  </div>
                </div>
              }

              @if (getComposer(); as composer) {
                <div class="cast-card">
                  @if (composer.profile_path) {
                    <img [src]="getProfileUrl(composer.profile_path)" [alt]="composer.name">
                  } @else {
                    <div class="no-photo">?</div>
                  }
                  <div class="cast-info">
                    <p class="name">{{ composer.name }}</p>
                    <p class="character">Hudba</p>
                  </div>
                </div>
              }
            </div>
          </div>
        }

        <!-- Herci -->
        @if (series.credits?.cast?.length) {
          <div class="section">
            <h2>Herci</h2>
            <div class="cast-grid">
              @for (actor of (series.credits?.cast || []).slice(0, 12); track actor.id) {
                <div class="cast-card">
                  @if (actor.profile_path) {
                    <img [src]="getProfileUrl(actor.profile_path)" [alt]="actor.name">
                  } @else {
                    <div class="no-photo">?</div>
                  }
                  <div class="cast-info">
                    <p class="name">{{ actor.name }}</p>
                    <p class="character">{{ actor.character }}</p>
                  </div>
                </div>
              }
            </div>
          </div>
        }
        
      </div>
    </div>
  }
</ion-content>